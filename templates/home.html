<!DOCTYPE html>
<html data-theme="dark">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="/static/styles.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" rel="stylesheet" />
  <title>Event Management Website</title>
</head>

<body>
  <div class="page-container">
    <!-- Header -->
    <div class="header">
      <div class="header-left">
        <h1>Event Manager</h1>
      </div>

      <div class="header-right">
        {% if username %}
          <a href="/profile/home" class="login-btn">Profile</a>
        {% else %}
          <a href="/login" class="login-btn">Login</a>
        {% endif %}
      </div>
    </div>

    <!-- Content -->
    <div class="content">
      <div class="left">
        <h2 style="text-align:center;">This Week</h2>
        <div class="menu scrollable-event-list">
          {% for event in events_today %}
            <a href="#" class="menuitem" onclick="showEventDetails({{ event.uid }})">
              {{ event.title or event.name or "Untitled Event" }}
            </a>
          {% endfor %}
          {% if not events_today %}
            <p style="padding: 10px; font-style: italic; color: var(--text-300);">No events today!</p>
          {% endif %}
        </div>
      </div>
      

      <div class="main">
        <div class="search-section">
          <h2 style="text-align:center;">Event Search</h2>

          <div class="search-box">
            <div class="search-centered">
              <div class="search">
                <form action="/search">
                  <input type="search" placeholder="Search..." name="search">
                  <button type="submit"><i class="fa fa-search"></i></button>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="right">
        <h2 style="margin-bottom: 10px;">Calendar</h2>
        <div id="mini-calendar"></div>
      </div>
      
      
    </div>

    <div style="clear: both;"></div>

    <!-- Footer -->
    <div class="footer">
      <div class="botnav">
        <a class="active" href="#home">Home</a>
        <a href="#About">About</a>
        <a href="#pPolicy">Privacy Policy</a>
        <a href="#Contact">Contact Us</a>
        <a>© copyright Does not Exist </a>
      </div>
    </div>

    <script>
      const toggleTheme = () => {
        const body = document.body;
        const isDark = body.getAttribute('data-theme') === 'dark';
        body.setAttribute('data-theme', isDark ? 'light' : 'dark');
      };
    </script>
  </div>

  <div id="eventModal" class="modal">
    <div class="modal-content">
      <span class="close-button" onclick="closeModal()">&times;</span>
      <div id="modalBody">
        <!-- Event details loaded here -->
      </div>
    </div>
  </div>

  <script>
    function showEventDetails(eventId) {
      fetch(`/api/event/${eventId}`)
        .then(res => {
          if (!res.ok) throw new Error("Event not found");
          return res.json();
        })
        .then(data => {
          const modalBody = document.getElementById("modalBody");
          modalBody.innerHTML = `
            <h2>${data.title}</h2>
            <p><strong>Date:</strong> ${data.date}</p>
            <p><strong>Time:</strong> ${data.start_time} – ${data.end_time}</p>
            <p><strong>Location:</strong> ${data.location}</p>
          `;
          document.getElementById("eventModal").style.display = "block";
        })
        .catch(err => {
          alert("Could not load event.");
          console.error(err);
        });
    }
  
    function closeModal() {
      document.getElementById("eventModal").style.display = "none";
    }

    document.addEventListener('DOMContentLoaded', function () {
      const calendarEl = document.getElementById('mini-calendar');
      const calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        headerToolbar: {
          left: 'prev',
          center: 'title',
          right: 'next'
        },
        height: 'auto',
        contentHeight: 300,
        events: '/api/user-events', 
        dayMaxEventRows: true,       
        eventDisplay: 'block',       
        eventClick: function(info) {
          const event = info.event;
          alert(
            `Title: ${event.title}\nStart: ${event.start}\nEnd: ${event.end || "N/A"}\nLocation: ${event.extendedProps.location || "N/A"}`
          );
          info.jsEvent.preventDefault();
        }
      });
      calendar.render();
      window.addEventListener("resize", () => {
        calendar.updateSize();
      });
    });
  </script>
  
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const calendarEl = document.getElementById('mini-calendar');
      const calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        headerToolbar: {
          left: 'prev',
          center: 'title',
          right: 'next'
        },
        height: 'auto',
        aspectRatio: 1.1, 
        contentHeight: 300,
        events: '/api/user-events',
        dayMaxEventRows: true,
        eventDisplay: 'block',
  
        dayHeaderFormat: { weekday: 'narrow' },
  
        eventClick: function(info) {
          const event = info.event;
          alert(
            `Title: ${event.title}\nStart: ${event.start}\nEnd: ${event.end || "N/A"}\nLocation: ${event.extendedProps.location || "N/A"}`
          );
          info.jsEvent.preventDefault();
        }
      });
      calendar.render();
    });
  </script>
</body>
</html>
