<!DOCTYPE html>
<html data-theme="dark">

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Event Management Website</title>
  <link rel="stylesheet" href="/static/styles.css">

</head>

<body>
  <div class=" page-container">
    <div class="header">
      <div class="header-left">
        <h1>Event Manager</h1>
      </div>

      <div class="header-right">
        <a href="/" class="login-btn">Home</a>
      </div>
    </div>

    <div class="content">
    <div class="left">
      <h2 style="text-align:center;">Account Settings</h2>
      <div class="menu">
        <a href="/profile/home" class="menuitem">Home</a>
        <a href="/profile/edit" class="menuitem">Edit Profile</a>
        <a href="/profile/security" class="menuitem">Security</a>
        <a href="/profile/calendar" class="menuitem">Calendar</a>
        <a href="/profile/events" class="menuitem">Events Joined</a>
        <!-- New Create Event button -->
        {% if is_organizer %}
        <a href="/organizer/create_event" class="menuitem">Create Event</a>
        {% endif %}
        <div><br></div>
        <a href="#" class="menuitem" onclick="logout()">Logout</a>

        </div>      
    </div>

      <!-- Main Section -->
      <div class="main">
        <div class="search-section">
          <h2 style="text-align:center;">Events Your Attending</h2>
          <div class="search-box">
            
            <div class="scrollable-event-list">
              {% if user_events %}
                {% for event in user_events %}
                  <div class="event-card">
                    <div class="event-inner"> <!-- This is the flex wrapper -->
    
                      <div class="event-details">
                        <span><b>Organizer:</b> {{ event.organizer }}</span><br>
                        <span><b>Event Created:</b> {{ event.date.strftime('%Y-%m-%d') }}</span><br>
                        <span><b>Start Time:</b> {{ event.start_time.strftime('%B %d, %Y – %I:%M %p') }}</span><br>
                        <span><b>End Time:</b> {{ event.end_time.strftime('%B %d, %Y – %I:%M %p') }}</span><br>
                        <span><b>Location:</b> {{ event.location }}</span><br>
                        <span><b>Description:</b> {{ event.description }}</span><br>
                        <span><b>Tags:</b> {{ event.tags }}</span>
                      </div>
    
                      <div class="scroll-join-button">
                        {% if username %}
                        {% set is_joined = event.uid in joined_event_ids %}
                        <button
                          class="join-btn"
                          onclick="toggleJoin({{ event.uid }}, this)"
                          data-joined="{{ 'true' if is_joined else 'false' }}"
                        >
                          {{ 'Joined!' if is_joined else 'Join' }}
                        </button>
                      {% else %}
                        <small style="color: gray;">Login to join</small>
                      {% endif %}
                      </div>
    
                    </div>
                  </div>
                {% endfor %}
              {% else %}
                <p style="color: var(--text-300); font-style: italic;">No events available.</p>
              {% endif %}
            </div>
          </div>

          <div class="refresh-container">
            <button class="join-btn refresh-btn" onclick="refresh()">Refresh List</button>
          </div>
          
        </div>
      </div>

    </div>



    <div class="footer">
      <div class="botnav">
        <a class="active" href="#home">Home</a>
        <a href="#About">About</a>
        <a href="#pPolicy">Privacy Policy</a>
        <a href="#Contact">Contact Us</a>
        <a>© copyright Does not Exist </a>
      </div>
    </div>

  
    <script>
      // Theme
      const toggleTheme = () => {
        const body = document.body;
        const isDark = body.getAttribute('data-theme') === 'dark';
        body.setAttribute('data-theme', isDark ? 'light' : 'dark');
      };

      // Update button
      function refresh() {
        location.reload();
      }

    // if user clicked join event
    function toggleJoin(eventId, button) {
      const isJoined = button.getAttribute("data-joined") === "true";
      const endpoint = isJoined ? `/api/unjoin_event/${eventId}` : `/api/join_event/${eventId}`;
    
      fetch(endpoint, {
        method: "POST",
      })
      .then(response => {
        if (response.ok) {
          if (isJoined) {
            button.innerText = "Join";
            button.setAttribute("data-joined", "false");
            button.classList.remove("joined");
          } else {
            button.innerText = "Joined!";
            button.setAttribute("data-joined", "true");
            button.classList.add("joined");
          }
        } else {
          return response.json().then(data => alert("Error: " + data.detail));
        }
      })
      .catch(error => {
        console.error("Request failed:", error);
        alert("Something went wrong.");
      });
    }


      // logout button
      function logout() {
        fetch("/logout", {
          method: "POST"
        }).then(() => {
          window.location.href = "/login";
        }).catch(err => {
          alert("Logout failed.");
          console.error(err);
        });
      }
            
    </script>
</div>
</body>

</html>